<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Greensphere Admin</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" th:href="@{/vendors/ti-icons/css/themify-icons.css}">
    <link rel="stylesheet" th:href="@{/vendors/base/vendor.bundle.base.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <link rel="shortcut icon" th:href="@{/images/gs-logo-.png}" type="image/png" />
</head>

<body>
    <div class="container-scroller">
        <!-- partial:partials/_navbar.html -->
        <!-- Include Navbar -->
        <div th:replace="~{fragments/navbar :: navbar}"></div>
        <!-- partial -->
        <div class="container-fluid page-body-wrapper">
            <!-- partial:partials/_sidebar.html -->
            <!-- Include Sidebar -->
            <div th:replace="~{fragments/sidebar :: sidebar}"></div>
            <!-- partial -->
            <div class="main-panel">
                <div class="content-wrapper">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h4 class="font-weight-bold mb-0">Greensphere Admin Dashboard</h4>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-primary btn-icon-text btn-rounded">
                                        <i class="ti-clipboard btn-icon-prepend"></i>Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Card for Turnover -->
                        <div class="col-md-3 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-title text-md-center text-xl-left">Turnover</p>
                                    <div
                                        class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
                                        <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">$34,040</h3>
                                        <i class="ti-calendar icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
                                    </div>
                                    <p class="mb-0 mt-2 text-success">78% <span class="text-black ms-1"><small>This
                                                month</small></span></p>
                                </div>
                            </div>
                        </div>
                        <!-- Card for Fines -->
                        <div class="col-md-3 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-title text-md-center text-xl-left">Fines</p>
                                    <div
                                        class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
                                        <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">$800</h3>
                                        <i class="ti-agenda icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
                                    </div>
                                    <p class="mb-0 mt-2 text-danger">64.00%<span class="text-black ms-1"><small>Pending
                                                payment</small></span></p>
                                </div>
                            </div>
                        </div>
                        <!-- Card for Registered Users -->
                        <div class="col-md-3 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-title text-md-center text-xl-left">Registered Users</p>
                                    <div
                                        class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
                                        <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0" id="total-users">...</h3>
                                        <i class="fas fa-users icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
                                    </div>
                                    <p class="mb-0 mt-2 text-success" id="active-percentage">0.00% <span
                                            class="text-black ms-1"><small>Active</small></span></p>
                                </div>
                            </div>
                        </div>
                        <!-- Card for Admin Accounts -->
                        <div class="col-md-3 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-title text-md-center text-xl-left">Admin accounts</p>
                                    <div
                                        class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
                                        <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0" id="total-admin-users">
                                            ...</h3>
                                        <i class="fas fa-user-shield icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
                                    </div>
                                    <p class="mb-0 mt-2 text-danger" id="admin-percentage">0.00%<span
                                            class="text-black ms-1"><small>Enabled</small></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Card for Garbage Categories -->
                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-title">Garbage categories</p>
                                    <p class="text-muted font-weight-light">Received overcame oh sensible so at an.
                                        Formed do change merely to county it. Am separate contempt domestic to to oh. On
                                        relation my so addition branched.</p>
                                    <div id="sales-legend" class="chartjs-legend mt-4 mb-2"></div>
                                    <canvas id="sales-chart"></canvas>
                                </div>
                                <div class="card border-right-0 border-left-0 border-bottom-0">
                                    <div class="d-flex justify-content-center justify-content-md-end">
                                        <div class="dropdown flex-md-grow-1 flex-xl-grow-0">
                                            <button
                                                class="btn btn-lg btn-outline-light dropdown-toggle rounded-0 border-top-0 border-bottom-0"
                                                type="button" id="dropdownMenuDate2" data-bs-toggle="dropdown"
                                                aria-haspopup="true" aria-expanded="true">
                                                Today
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right"
                                                aria-labelledby="dropdownMenuDate2">
                                                <a class="dropdown-item" href="#">January - March</a>
                                                <a class="dropdown-item" href="#">March - June</a>
                                                <a class="dropdown-item" href="#">June - August</a>
                                                <a class="dropdown-item" href="#">August - November</a>
                                            </div>
                                        </div>
                                        <button
                                            class="btn btn-lg btn-outline-light text-primary rounded-0 border-0 d-none d-md-block"
                                            type="button"> View all </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Card for DB Health Monitor -->
                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card border-bottom-0">
                                <div class="card-body pb-0">
                                    <p class="card-title">DB Health monitor</p>
                                    <p class="text-muted font-weight-light">Maintain a healthy DB and monitor your DB.
                                        Check for any anomalies or excess executions in the last 24-hour</p>
                                    <div class="d-flex flex-wrap mb-5">
                                        <div class="me-5 mt-3">
                                            <p class="text-muted">DB Status</p>
                                            <h3 id="db-status">...</h3>
                                        </div>
                                        <div class="me-5 mt-3">
                                            <p class="text-muted">All users</p>
                                            <h3 id="all-users">...</h3>
                                        </div>
                                        <div class="me-5 mt-3">
                                            <p class="text-muted">Disposal records</p>
                                            <h3 id="disposal-value">...</h3>
                                        </div>
                                        <div class="mt-3">
                                            <p class="text-muted">Executions on DB /24hr</p>
                                            <h3 id="executions-value">...</h3>
                                        </div>
                                    </div>
                                </div>
                                <canvas id="order-chart" class="w-100"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Card for Top Products -->
                        <div class="col-md-7 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-title mb-0">Top Products</p>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>User</th>
                                                    <th>Role</th>
                                                    <th>Status</th>
                                                    <th>Last login</th>
                                                    <th>Disposal %</th>
                                                </tr>
                                            </thead>
                                            <tbody id="top-products-body">
                                                <tr>
                                                    <td>...</td>
                                                    <td>...</td>
                                                    <td>...</td>
                                                    <td>...</td>
                                                    <td>...</td>
                                                </tr>
                                                <!-- More rows here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Card for Notifications -->
                        <div class="col-md-5 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-title mb-0">Notifications</p>
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <p class="text-muted mb-0">Recent notifications</p>
                                        <button class="btn btn-primary btn-icon-text btn-rounded">
                                            <i class="ti-clipboard btn-icon-prepend"></i>Generate Report
                                        </button>
                                    </div>
                                    <div class="d-flex flex-column">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <div class="d-flex align-items-center">
                                                <i class="ti-server text-primary me-3"></i>
                                                <div>
                                                    <p class="text-muted mb-1">Record Generation</p>
                                                    <h6 class="font-weight-bold mb-0">New record created</h6>
                                                </div>
                                            </div>
                                            <p class="text-muted mb-0">2 min ago</p>
                                        </div>
                                        <!-- More notifications here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- content-wrapper ends -->
                <!-- partial:partials/_footer.html -->
                <!-- Include Footer -->
                <div th:replace="~{fragments/footer :: footer}"></div>
                <!-- partial -->
            </div>
            <!-- main-panel ends -->
        </div>
    </div>
    <script>
        async function fetchHealthStatus() {
            try {
                // Make the GET request to the /actuator/health endpoint
                const response = await fetch('/actuator/health');
                const healthData = await response.json();

                // Check the health status
                const status = healthData.status; // This will typically be 'UP' or 'DOWN'

                // Update the HTML with the health status
                document.getElementById('db-status').textContent = status === 'UP' ? 'Connected' : 'Disconnected';
            } catch (error) {
                console.error('Error fetching health status:', error);
                document.getElementById('db-status').textContent = 'Error';
            }
        }

        // Call the function to fetch and display the health status
        fetchHealthStatus();
        document.addEventListener('DOMContentLoaded', function () {
            fetch("/api/v1/admin/allusers")
                .then(response => response.json())
                .then(data => {
                    // Calculate the total number of users
                    const totalUsers = data.length;
                    // Number of active users
                    const activeUsers = data.filter(user => user.status === true).length;
                    const inactiveUsers = data.filter(user => user.status === false).length;
                    const activePercentage = ((activeUsers / totalUsers) * 100).toFixed(2);
                    const inactivePercentage = ((inactiveUsers / totalUsers) * 100).toFixed(2);
                    // Update the HTML content with the total number of users
                    //document.getElementById('active-percentage').innerHTML = `${activePercentage}% <span class="text-black ms-1"><small>Active users</small></span>`;
                    document.getElementById('admin-percentage').innerHTML = `${inactivePercentage}% <span class="text-black ms-1"><small>Disabled</small></span>`;
                    //document.getElementById('inactive-users').textContent = inactiveUsers;
                    animateCounter('total-admin-users', totalUsers);
                    animateCounter('all-users', 490);
                    animateCounter('total-users', 490);
                    animateCounter('inactive-users', inactiveUsers);
                    animateCounter('disposal-value', 520);
                    animateCounter('executions-value', 109020);

                    // Fetch the database health status

                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
        function animateCounter(elementId, endValue) {
            const element = document.getElementById(elementId);
            let startValue = 0;
            const duration = 2000; // Duration of the animation in milliseconds
            const increment = Math.ceil(endValue / (duration / 20)); // Increment based on the duration and refresh rate (20ms)

            const counter = setInterval(() => {
                startValue += increment;
                if (startValue >= endValue) {
                    startValue = endValue;
                    clearInterval(counter);
                }
                element.textContent = startValue;
            }, 20); // Update the counter every 20ms
        }

    </script>
    <!-- plugins:js -->
    <script th:src="@{/vendors/base/vendor.bundle.base.js}"></script>
    <!-- endinject -->
    <!-- inject:js -->
    <script src="/js/off-canvas.js"></script>
    <script src="/js/hoverable-collapse.js"></script>
    <script src="/js/misc.js"></script>
    <script src="/js/settings.js"></script>
    <script src="/js/todolist.js"></script>
    <script src="/js/chart.js"></script>
    <!-- endinject -->
</body>

</html>